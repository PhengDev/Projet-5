<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <title>
            {% block title %}Welcome!
            {% endblock %}
        </title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.css" integrity="sha256-piqEf7Ap7CMps8krDQsSOTZgF+MU/0MPyPW2enj5I40=" crossorigin="anonymous" />
      
        <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" rel="stylesheet"> {% block stylesheets %}{% endblock %}
        <link href="{{ asset('build/style.css')}}" rel="stylesheet">
    </head>

    <body>
        <nav class="navbar navbar-expand-lg nav-bg position-fixed" >
            <a class="navbar-brand" href="{{ path('home') }}"><img src="/images/logo/logo.png/" class="logo"></a>
            <button aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarSupportedContent" data-toggle="collapse" type="button">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-4">
                    <li class="nav-item">
                        <a class="nav-link black-color{% if current_menu is defined and current_menu == 'properties' %}active btn btn-primary{% endif %}" href="{{ path('property.collection') }}">Collection</a>
                    </li>
                </ul>
                <ul class="navbar-nav mr-4">
                    <li class="nav-item">
                        <a class="nav-link black-color{% if current_menu is defined and current_menu == 'contact' %}active btn btn-primary{% endif %}" href="{{ path('contact') }}">Contact</a>
                    </li>
                </ul>
                <div class="form-inline active-cyan-4 mr-4">
                    <input aria-label="Recherche" class="form-control form-control-sm mr-3 w-75" id="search" placeholder="Search" type="text">
               
                    <i aria-hidden="true" class="fas fa-search"></i>
                     <div class="position-absolute bg-white" id="entitiesNav"></div>
                </div>

            {% if is_granted('ROLE_USER') %}
                <div class="dropdown dropbottom">
                    <a aria-expanded="false" aria-haspopup="true" class="btn dropdown-toggle" data-toggle="dropdown" href="#" id="dropdownMenuLink" role="button">{{ app.user.username }}</a>
                    <div aria-labelledby="dropdownMenuLink" class="dropdown-menu dropdown-menu-bottom">    
                      <a class="nav-link" href="{{path('profil')}}">Espace membre</a> 
                        <a class="dropdown-item menu-hover" href="{{ path('logout') }}">Se déconnecter</a>
                    </div>
                </div>
                   {{ render(controller('App\\Controller\\PanierController::nbArticle')) }}
            {% elseif is_granted('ROLE_ADMIN') %}
                <div class="dropdown dropbottom">
                    <a aria-expanded="false" aria-haspopup="true" class="btn dropdown-toggle" data-toggle="dropdown" href="#" id="dropdownMenuLink" role="button">{{ app.user.username }}</a>
                    <div aria-labelledby="dropdownMenuLink" class="dropdown-menu dropdown-menu-bottom">
                     <a class="nav-link" href="{{path('profil')}}">Espace membre</a> 
                        <a class="nav-link" href="{{ path('admin.property.index') }}">Administration</a>
                        <a class="dropdown-item menu-hover" href="{{ path('logout') }}">Se déconnecter</a>
                    </div>
                </div>
                {{ render(controller('App\\Controller\\PanierController::nbArticle')) }}
            {% else %}
                <ul class="navbar-nav nav">
                    <li class="nav-item">
                        <a class="nav-link black-color mr-4 {% if current_menu is defined and current_menu == 'login' %}active btn btn-primary text-white{% endif %}" href="{{ path('login') }}">
                            <i class="fas fa-sign-in-alt mr-2"></i>Se connecter</a>
                      
                    </li>
                    <li class="nav-item">
                      <a href="{{ path('registration') }}" class="nav-link black-color{% if current_menu is defined and current_menu == 'registration' %}active btn btn-primary text-white{% endif %}" ><i class="fas fa-file-signature"></i>S'inscrire</a>
                     </li>
                </ul>
            {% endif %}
             </div>
        </div>
        </nav>
   {% block body %}{% endblock %}
   {% block javascripts %}{% endblock %}
     <footer class="font-small bg-dark pt-2">
     <div class="d-flex justify-content-between">
     <div class="span3 push-left text-white ml-5">
                <dl class="push-left">
                    <dt><h4>CONTACTS</h4></dt>
                    <dt class="mb-2"><i class="fas fa-map-marker-alt mr-2"></i>Adresse : 8 Place du Château, 30000 Nîmes</dt>
                    <dt><i class="fas fa-phone-alt mr-2"></i>Numéro : 06 07 08 09 10</dt>
                </dl>
            </div>
            <div class="span3 push-right text-center text-white mr-5">
                <dl class=" push-right">
                    <dt><h4>INFORMATIONS</h4></dt>
                    <dt class="mb-2"><a href="#">CGU</a></dt>
                    <dt><a href="#">Mentions légales</a></dt>
                </dl>
            </div>
             <div class="span3 push-right text-center text-white mr-5">
                <dl class=" push-right">
                    <dt><h4>LIENS</h4></dt>
                    <dt><a href="#"><i class="fab fa-facebook-square lien-logo"></i></a></dt>
                    <dt><a href="#"><i class="fab fa-twitter-square lien-logo"></i></a></dt>
                    <dt><a href="#"><i class="fab fa-instagram lien-logo"></i></a></dt>
                </dl>
            </div>
            </div>
        <div class="clearfix"></div>
        <div class="d-flex justify-content-center span3">
            <i class="far fa-copyright float-left mr-2 text-white"></i>
            <p class="text-footer text-light"> 2019 LY PHENG - OPENCLASSCROOM</p>
        </div>
    </footer>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" type="text/javascript"></script>
   <script crossorigin="anonymous" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
   <script crossorigin="anonymous" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
     <script src="{{ asset('build/script.js')}}" type="text/javascript"></script>
    <script type="text/javascript">

    class SearchBar {
    constructor({target, showResult}) {
        this.target = target;
        this.showResult = showResult;
        this.timeOut = null;
        this.init();
    }

    init() {
        let searchRequest = null;
        const target = this.target;
        const showResult = this.showResult;
        $(target).keyup(function () {
            const minlength = 1;
            let value = $(this).val();
            if (value.length >= minlength) {
                if (searchRequest != null) {
                    searchRequest.abort();
                }
                searchRequest = $.ajax({
                    type: "GET",
                    url: "{{ path('ajax_search') }}",
                    data: {
                        'q': value
                    },
                    dataType: "html",
                    success: (response) => {
                        if (value == $(this).val()) {
                            var result = JSON.parse(response);
                            $.each(result,  (key, arr) => {
                                $.each(arr,  (id, resutls) => {
                                    if (key == "properties") {
                                        if (id != 'error') {
                                        const link = document.createElement("a");
                                        $(link).addClass("text-primary");
                                        $(link).attr("href",'/collection/' + resutls + '-' + id + '');
                                        $(link).html('' + resutls + ' <hr>');
                                        $(showResult).append(link);
                                        $(showResult).show();
                                        } else {
                                            $(showResult).show();
                                            $(showResult).append('<div class="errorLi">' + resutls + '</div>');
                                        }
                                    }
                                });
                            });
                        }
                    }
                });
            } 
        })
        .keydown(function(){
            $(showResult).hide();
            $(showResult).html("");
        })
    }
}

function initSearch() {
    new SearchBar({
        target: $("#search"), 
        showResult: $('#entitiesNav')
        });
}

if ($('.page').height() < 450) {
    $('.page').css("height","38em");
} else {
    $('.page').css("height","auto");
}

if (window) {
    window.addEventListener("load", () => {
        initSearch();
    })
}
</script>
   
</body>
</html>
